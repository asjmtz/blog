<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Protractor 学习笔记 · ASJMTZ's Blog</title><meta name="description" content="Protractor 学习笔记 - ASJMTZ"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://iamtutu.com/atom.xml" title="ASJMTZ's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/asjmtz" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Protractor 学习笔记</h1><div class="post-info">Sep 30, 2014</div><div class="post-content"><h2 id="准备活动"><a href="#准备活动" class="headerlink" title="准备活动"></a>准备活动</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>protractor 是个 <a href="http://nodejs.org/" target="_blank" rel="external">Node.js</a> 程序。所以首先得安装 Node.js。然后就可以使用npm 安装 protractor 了。</p>
<p>通常 protractor 使用 <a href="http://jasmine.github.io/1.3/introduction.html" target="_blank" rel="external">Jasmine</a> 测试框架作为他的测试接口。</p>
<p>下面的教程的测试将使用一个独立的 Selenium Server 来控制浏览器。需要安装 JDK 来运行这个服务器。可以用 <code>java -version</code> 命令来测试是否安装成功 JDK。</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>全局安装protractor<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install -g protractor</div></pre></td></tr></table></figure></p>
<p>这个命令会安装两个命令行工具，protractor 和 webdriver-manager。尝试跑 <code>protractor --version</code> 确认安装成功。webdriver-manager 是一个辅助工具，他可以简单的让Selenium Server 的实例跑起来？？用这个命令可以让他来下载必要的 binaries：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">webdriver-manager update</div></pre></td></tr></table></figure></p>
<p>现在可以打开一个服务器<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">webdriver-manager start</div></pre></td></tr></table></figure></p>
<p>这个命令会开启一个Selenium Server ，然后输出一串的 log 信息。你的 Protractor 测试将会把请求发到服务器来控制本地的浏览器。在整个教程中，请让服务器在后面撒欢的跑。你可以到这里看服务器的状态信息 <a href="http://localhost:4444/wd/hub" target="_blank" rel="external">http://localhost:4444/wd/hub</a> 。</p>
<h2 id="step-0-写一测试"><a href="#step-0-写一测试" class="headerlink" title="step 0 - 写一测试"></a>step 0 - 写一测试</h2><p>新开个命令行或终端窗口，并选个干净整洁的文件夹来做测试目录。</p>
<p>Protractor 运行需要两个文件，一个是 <strong>spec file</strong> ，一个是 <strong>configuration file</strong>。</p>
<p>我们先从一个简单的测试开始，内容是引导一个Angular app 例子和检验他的title。我们将会用到这里的 Super Calculator application —— <a href="http://juliemr.github.io/protractor-demo/" target="_blank" rel="external">http://juliemr.github.io/protractor-demo/</a></p>
<p>将下面的代码 copy 到 spec.js 中：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// spec.js</div><div class="line">describe(&apos;angularjs homepage&apos;, function() &#123;</div><div class="line">  it(&apos;should have a title&apos;, function() &#123;</div><div class="line">    browser.get(&apos;http://juliemr.github.io/protractor-demo/&apos;);</div><div class="line"></div><div class="line">    expect(browser.getTitle()).toEqual(&apos;Super Calculator&apos;);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p> 这里 <code>describe</code> 和 <code>it</code> 语法来自 Jasmine 框架。<code>browser</code> 由 Protractor 全局创建的，他可以用来执行浏览器级别的命令，例如用 <code>browser</code> 导航。</p>
<p>现在来创建配置文件，将下面的代码 copy 到 conf.js：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// conf.js</div><div class="line">exports.config = &#123;</div><div class="line">  seleniumAddress: &apos;http://localhost:4444/wd/hub&apos;,</div><div class="line">  specs: [&apos;spec.js&apos;]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这个配置文件通知 Protractor 你的测试文件（specs）的位置，还有Selenium Server 的对话地址（seleniumAddress）。其他配置项使用默认的，Chrome是默认浏览器。</p>
<p>现在运行测试<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">protractor conf.js</div></pre></td></tr></table></figure></p>
<p>OK! 我们会看到 Chrome 打开一个指向 Calculator 的窗口，然后又闪关了。测试结果输出应为 <code>1 tests, 1 assertion, 0 failures</code>。真是可喜可贺，我们第一个 Protractor 测试已经成功了 (^o^)/~</p>
<h2 id="step-1-元素交互"><a href="#step-1-元素交互" class="headerlink" title="step 1 - 元素交互"></a>step 1 - 元素交互</h2><p>现在来修改下测试文件，让他与页面上的文件进行交互吧！变 ~ 身 ~<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">// spec.js</div><div class="line">describe(&apos;angularjs homepage&apos;, function() &#123;</div><div class="line">  it(&apos;should add one and two&apos;, function() &#123;</div><div class="line">    browser.get(&apos;http://juliemr.github.io/protractor-demo/&apos;);</div><div class="line">    element(by.model(&apos;first&apos;)).sendKeys(1);</div><div class="line">    element(by.model(&apos;second&apos;)).sendKeys(2);</div><div class="line"></div><div class="line">    element(by.id(&apos;gobutton&apos;)).click();</div><div class="line"></div><div class="line">    expect(element(by.binding(&apos;latest&apos;)).getText()).</div><div class="line">        toEqual(&apos;5&apos;); // This is wrong!</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>这里也使用了两个 Protractor 创建的全局 <code>elemenet</code> 和 <code>by</code>。<code>element</code> 函数用来寻找页面 HTML 元素，他会返回一个 ElementFinder 对象，这个对象可与元素交互或者获取他们的信息（狗仔队~~）。在这个测试中，我们使用 <code>sendKeys</code> 来给 <code>&lt;input&gt;</code> 输入值，<code>click</code> 来点击按钮，<code>getText</code> 来返回元素的内容。</p>
<p><code>element</code> 需要一个定位仪参数。<code>by</code> 元素创建了定位仪，我们使用三个类型的定位仪。</p>
<ul>
<li><code>by.model(&#39;first&#39;)</code> 来查找元素 <code>ng-model=&quot;first&quot;</code>。</li>
<li><code>by.id(&#39;gobutton&#39;)</code> 来根据给定的id查找。</li>
<li><code>by.binding(&#39;latest&#39;)</code> 来发现绑定了latest变量的元素，即 <code>{ {latest} }</code></li>
</ul>
<p><a href="http://angular.github.io/protractor/#/locators" target="_blank" rel="external">关于定位仪 (by) 和元素查找器 (element) 的更多信息</a></p>
<p>运行测试<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">protractor conf.js</div></pre></td></tr></table></figure></p>
<p>1 + 2 == 5肯定会 failed 啦~(≧▽≦)/~啦啦啦 </p>
<h2 id="step-2-多个测试"><a href="#step-2-多个测试" class="headerlink" title="step 2 - 多个测试"></a>step 2 - 多个测试</h2><p>稍微美化点，将两个测试结合起来，提出重复的部分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">// spec.js</div><div class="line">describe(&apos;angularjs homepage&apos;, function() &#123;</div><div class="line">  var firstNumber = element(by.model(&apos;first&apos;));</div><div class="line">  var secondNumber = element(by.model(&apos;second&apos;));</div><div class="line">  var goButton = element(by.id(&apos;gobutton&apos;));</div><div class="line">  var latestResult = element(by.binding(&apos;latest&apos;));</div><div class="line"></div><div class="line">  beforeEach(function() &#123;</div><div class="line">    browser.get(&apos;http://juliemr.github.io/protractor-demo/&apos;);</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  it(&apos;should have a title&apos;, function() &#123;</div><div class="line">    expect(browser.getTitle()).toEqual(&apos;Super Calculator&apos;);</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  it(&apos;should add one and two&apos;, function() &#123;</div><div class="line">    firstNumber.sendKeys(1);</div><div class="line">    secondNumber.sendKeys(2);</div><div class="line"></div><div class="line">    goButton.click();</div><div class="line"></div><div class="line">    expect(latestResult.getText()).toEqual(&apos;3&apos;);</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  it(&apos;should add four and six&apos;, function() &#123;</div><div class="line">    // Fill this in.</div><div class="line">    expect(latestResult.getText()).toEqual(&apos;10&apos;);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>这里，我们将导航拉到一个 <code>beforeEach</code> 函数里，他会运行在每个 <code>it</code> 块前。</p>
<h2 id="step-3-改变配置"><a href="#step-3-改变配置" class="headerlink" title="step 3 - 改变配置"></a>step 3 - 改变配置</h2><p>变 ~ 身 ~ (^o^)/~<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// conf.js</div><div class="line">exports.config = &#123;</div><div class="line">  seleniumAddress: &apos;http://localhost:4444/wd/hub&apos;,</div><div class="line">  specs: [&apos;spec.js&apos;],</div><div class="line">  capabilities: &#123;</div><div class="line">    browserName: &apos;firefox&apos;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>尝试重新运行测试。我们可以看到 Firefox 代替 chrome 跑了出来。<code>capabilities</code> 对象描述了测试使用的浏览器。所有可用的选项，看这里 <a href="https://github.com/angular/protractor/blob/master/docs/referenceConf.js" target="_blank" rel="external">the reference config file</a></p>
<p>还可以一次在多个浏览器中跑测试，像这样<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">// conf.js</div><div class="line">exports.config = &#123;</div><div class="line">  seleniumAddress: &apos;http://localhost:4444/wd/hub&apos;,</div><div class="line">  specs: [&apos;spec.js&apos;],</div><div class="line">  multiCapabilities: [&#123;</div><div class="line">    browserName: &apos;firefox&apos;</div><div class="line">  &#125;, &#123;</div><div class="line">    browserName: &apos;chrome&apos;</div><div class="line">  &#125;]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>大家可以试试看效果。Chrome 和 Firefox 会同步进行测试，命令行中的结果是独立显示的。</p>
<p>我的 Firefox 没有安装在默认 C 盘的路径上，所以有报错 <code>Cannot find firefox binary in PATH. Make sure firefox is installed.</code> ，把 <code>firefox.exe</code> 的路径加在了系统变量 PATH ，也没有解决。</p>
<p>这个问题修改的<a href="http://sariyalee.iteye.com/blog/1688271" target="_blank" rel="external">参考文章</a>，万万没想到，我最后还是重装了Firefox。不知道以后还能不能愉快地自定义安装地址了呢╮(╯▽╰)╭</p>
<h2 id="step-4-元素列表"><a href="#step-4-元素列表" class="headerlink" title="step 4 - 元素列表"></a>step 4 - 元素列表</h2><p>重新回到测试文件，有时会遇到多个元素的列表需要处理的问题。可以用 <code>element.all</code> 处理，这个方法会返回一个 ElementArrayFinder。在我们的这个 Calculator app 中，每个操作都记录在一个历史的表格中，使用的是 Angular 的 <code>ng-repeater</code>。下面让我们来测试这些操作是否记录在表格中。</p>
<p>变 ~ 身 ~ (^o^)/~<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">// spec.js</div><div class="line">describe(&apos;angularjs homepage&apos;, function() &#123;</div><div class="line">  var firstNumber = element(by.model(&apos;first&apos;));</div><div class="line">  var secondNumber = element(by.model(&apos;second&apos;));</div><div class="line">  var goButton = element(by.id(&apos;gobutton&apos;));</div><div class="line">  var latestResult = element(by.binding(&apos;latest&apos;));</div><div class="line">  var history = element.all(by.repeater(&apos;result in memory&apos;));</div><div class="line"></div><div class="line">  function add(a, b) &#123;</div><div class="line">    firstNumber.sendKeys(a);</div><div class="line">    secondNumber.sendKeys(b);</div><div class="line">    goButton.click();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  beforeEach(function() &#123;</div><div class="line">    browser.get(&apos;http://juliemr.github.io/protractor-demo/&apos;);</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  it(&apos;should have a history&apos;, function() &#123;</div><div class="line">    add(1, 2);</div><div class="line">    add(3, 4);</div><div class="line"></div><div class="line">    expect(history.count()).toEqual(2);</div><div class="line"></div><div class="line">    add(5, 6);</div><div class="line"></div><div class="line">    expect(history.count()).toEqual(0); // This is wrong!</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>这里我们做了两件事：</p>
<ul>
<li>首先，我们创建了一个辅助函数<code>add</code>，并且增加了变量 <code>history</code>。</li>
<li>我们用了 <code>element.all</code> 结合 <code>by.repeater</code> 定位仪来获得一个 ElementArrayFinder。在 spec 文件中，我们用了count函数计算了历史记录的应有 length 。</li>
</ul>
<p><code>ElementArrayFinder</code> 处理 <code>add</code> 外还有许多方法。用 <code>last</code> 来获得一个匹配定位仪获得元素集中的最后一个元素。</p>
<pre><code>it(&apos;should have a history&apos;, function() {
    add(1, 2);
    add(3, 4);

    expect(history.last().getText()).toContain(&apos;1 + 2&apos;);
    expect(history.first().getText()).toContain(&apos;foo&apos;); // This is wrong!
  });
</code></pre><p>因为 Calculator 展示了最老的结果在底部，我们用 <code>toContain</code> Jasmine 匹配来假设元素的文字包含有“1+2”。</p>
<p>ElementArrayFinder 还有 <code>each</code>、<code>map</code>、 <code>filter</code> 和 <code>reduce</code> 这些方法和 JS 的数组方法很相似。<a href="http://angular.github.io/protractor/#/api?view=ElementArrayFinder" target="_blank" rel="external">更多 API 细节看这里</a></p>
<blockquote>
<p>Written with <a href="https://stackedit.io/" target="_blank" rel="external">StackEdit</a>.</p>
</blockquote>
</div></article></div></section><footer><div class="paginator"><a href="/2014/10/26/1013-getBoundClientRect/" class="prev">上一篇</a><a href="/2014/09/26/0926-angular lesson3/" class="next">下一篇</a></div><div class="copyright"><p>© 2016 - 2017 <a href="http://iamtutu.com">ASJMTZ</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>