<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> grunt 项目架设 · ASJMTZ's Blog</title><meta name="description" content="grunt 项目架设 - ASJMTZ"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://iamtutu.com/atom.xml" title="ASJMTZ's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/asjmtz" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">grunt 项目架设</h1><div class="post-info">Jun 25, 2014</div><div class="post-content"><blockquote>
<p>参考文章<br><a href="http://www.hulufei.com/post/grunt-introduction" target="_blank" rel="external">《前端工作流，Grunt上手指南》</a><br><a href="http://my.oschina.net/liuyong25/blog/140110#OSC_h4_6" target="_blank" rel="external">《Grunt+Livereload 搭建本地前端开发环境》</a></p>
</blockquote>
<p>废话就不多说了，直接开始架设一个grunt控制的项目吧！O(∩_∩)O</p>
<p>##1. 假设你已经安装了nodeJS和用npm全局安装了grunt-cli。</p>
<p>##2. 新建package.json和Gruntfile.js<br>先进入项目文件夹的根目录下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ mkdir pj</div><div class="line">$ cd pj</div></pre></td></tr></table></figure></p>
<p>###package.json</p>
<p>根据上面的参考文章，直接执行<code>npm install</code>会生成一个空的package.js，但是我尝试之后失败了，是版本的问题吗？<br>顺便一说，我的版本是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ grunt -V </div><div class="line">grunt-cli v0.1.13</div><div class="line">grunt v0.4.5</div><div class="line"></div><div class="line">$ npm -v</div><div class="line">1.4.9</div></pre></td></tr></table></figure></p>
<p>于是从前几篇的grunt笔记里面copy一个现有的<code>package.json</code> ，里面写好了要安装的一些常用的grunt项目插件包括grunt本身，大概酱紫。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;name&quot;: &quot;pj3&quot;,</div><div class="line">  &quot;version&quot;: &quot;0.1.0&quot;,</div><div class="line">  &quot;devDependencies&quot;: &#123;</div><div class="line">    &quot;grunt&quot;: &quot;^0.4.5&quot;,</div><div class="line">    &quot;grunt-contrib-concat&quot;: &quot;^0.4.0&quot;,</div><div class="line">    &quot;grunt-contrib-jshint&quot;: &quot;^0.10.0&quot;,</div><div class="line">    &quot;grunt-contrib-nodeunit&quot;: &quot;^0.4.1&quot;,</div><div class="line">    &quot;grunt-contrib-qunit&quot;: &quot;^0.5.1&quot;,</div><div class="line">    &quot;grunt-contrib-uglify&quot;: &quot;^0.5.0&quot;,</div><div class="line">    &quot;grunt-contrib-watch&quot;: &quot;^0.6.1&quot;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>好了，现在执行一下 <code>npm install</code>就会自动帮你安装以上列出来的依赖。而且安装好之后根据安装的版本，会更改到你的package.json的文件中。所以我上面的package.json其实是已经安装，并被更改过的了。现在文件结构是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">pj/</div><div class="line">|-- node_modules</div><div class="line">`-- package.json</div></pre></td></tr></table></figure></p>
<p>###Gruntfile.js</p>
<p>可以从之前的笔记上或者官网上手动创建，下面介绍用 <code>grunt-init</code>安装一些架构的方法。</p>
<ol>
<li>全局安装<code>npm install -g grunt-init</code></li>
<li><p>克隆要使用的模板,下面是clone到一个创建一个包含QUnit单元测试的jQuery插件的模板，模板更多介绍<a href="http://www.gruntjs.org/article/project_scaffolding.html" target="_blank" rel="external">在这里</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git clone https://github.com/gruntjs/grunt-init-jquery.git ~/.grunt-init/jquery</div></pre></td></tr></table></figure>
</li>
<li><p>我用上面的方法clone了一个 <code>grunt-init-gruntfile</code> ，然后再执行 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">grunt-init  gruntfile</div></pre></td></tr></table></figure>
</li>
</ol>
<p>好了，现在grunt-init已经根据你的package.json的配置，帮你写好一个Gruntfile.js，可以在此模板上根据需要修改下</p>
<p>然后我手贱安装了下 <code>grunt-init jquery</code>，假装我要写一个叫jquery.barAnime的插件，于是在执行安装之前，grunt-init细心的询问了我各种问题，然后生成一个 <code>jquery.barAnime.jquery.json</code>来记录。=&gt;（可能是我起的名字问题，json名字略奇葩</p>
<p>目录变成酱紫了，欧也(^o^)/<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">pj/</div><div class="line">|-- node_modules/</div><div class="line">|-- libs/</div><div class="line">|-- src/</div><div class="line">|-- test/</div><div class="line">|-- .gitignore</div><div class="line">|-- .jshintrc</div><div class="line">|-- CONTRIBUTING.md</div><div class="line">|-- jquery.barAnime.jquery.json</div><div class="line">|-- LICENSE-MIT</div><div class="line">|-- README.md</div><div class="line">|-- Gruntfile.js</div><div class="line">`-- package.json</div></pre></td></tr></table></figure></p>
<p>生成了一些奇怪的文件，发现里面还有一个<code>LICENSE-MIT</code>，小白的我瞬间觉得UP了(⊙o⊙)哦</p>
<p>##3. 执行grunt命令<br>根据Gruntfile.js里面的配置，执行 <code>grunt</code>命令时，会执行 <code>default</code>任务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">grunt.registerTask(&apos;default&apos;, [&apos;jshint&apos;, &apos;qunit&apos;, &apos;clean&apos;, &apos;concat&apos;, &apos;uglify&apos;]);</div></pre></td></tr></table></figure></p>
<p>我用 <code>grunt-init jquery</code> 自动生成的Gruntfile里面主要执行的就是以上几个命令，根目录会多出一个dist文件夹，里面是<code>concat</code>合并的 <code>jquery.barAnime.js</code> 和 <code>uglify</code>压缩的 <code>jquery.barAnime.min.js</code>。</p>
<p>##4. 手动建立一个项目，并创建livereload</p>
<p>利用 <code>grunt watch</code> 和 <code>grunt connect</code> 和 <code>connect-livereload</code>的配合就能省去F5与浏览器的livereload插件了，啊哈哈，快点开始吧</p>
<p>参照这个大大的<a href="http://my.oschina.net/liuyong25/blog/140110#OSC_h4_6" target="_blank" rel="external">文章</a>。我重新新建了一个项目，叫做pj4的<br>按照上面的步骤，我安装了与上面一样的grunt和grunt插件，为了livereload的实现，还得再安装一些东西<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install --save-dev grunt-contrib-connect connect-livereload grunt-open</div></pre></td></tr></table></figure></p>
<p>现在的文档目录如下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">pj4/</div><div class="line">|-- node_modules/</div><div class="line">|-- src/</div><div class="line">|    |-- js/</div><div class="line">|    |-- css/</div><div class="line">|    |-- img/</div><div class="line">|    `-- index.html</div><div class="line">|-- Gruntfile.js</div><div class="line">`-- package.json</div></pre></td></tr></table></figure>
<p>下面是特别重要的Gruntfile.js的内容。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 自动化脚本定义</div><div class="line"> */</div><div class="line">module.exports = function (grunt) &#123;</div><div class="line">  &apos;use strict&apos;;</div><div class="line"></div><div class="line">  //load all grunt tasks</div><div class="line">  require(&apos;matchdep&apos;).filterDev(&apos;grunt-*&apos;).forEach(grunt.loadNpmTasks);</div><div class="line"></div><div class="line">  //define tasks</div><div class="line">  grunt.registerTask(&apos;server&apos;, [&apos;connect:server&apos;, &apos;open:server&apos;, &apos;watch:server&apos;]);</div><div class="line"></div><div class="line">  //env cfg</div><div class="line">  var pkg = grunt.file.readJSON(&apos;package.json&apos;);</div><div class="line">  var cfg = &#123;</div><div class="line">    src: &apos;src&apos;,</div><div class="line">    // Change &apos;localhost&apos; to &apos;0.0.0.0&apos; to access the server from outside.</div><div class="line">    serverHost: &apos;localhost&apos;,</div><div class="line">    serverPort: 9000,</div><div class="line">    livereload: 35729</div><div class="line">  &#125;;  </div><div class="line"></div><div class="line">  //grunt config</div><div class="line">  grunt.initConfig(&#123;</div><div class="line">    //======== 配置相关 ========</div><div class="line">    pkg: pkg,</div><div class="line">    cfg: cfg,</div><div class="line"></div><div class="line">    //======== 开发相关 ========</div><div class="line">   //开启服务</div><div class="line">    connect: &#123;</div><div class="line">      options: &#123;</div><div class="line">        port: cfg.serverPort,</div><div class="line">        hostname: cfg.serverHost,</div><div class="line">        middleware: function(connect, options) &#123;</div><div class="line">          return [</div><div class="line">            require(&apos;connect-livereload&apos;)(&#123;</div><div class="line">              port: cfg.livereload</div><div class="line">            &#125;),</div><div class="line">            // Serve static files. </div><div class="line">            //In my environment options.base is a type of Object</div><div class="line">            connect.static(options.base.toString()),</div><div class="line">            // Make empty directories browsable.</div><div class="line">             connect.directory(options.base),</div><div class="line">          ];</div><div class="line">        &#125;</div><div class="line">      &#125;,</div><div class="line">      server: &#123;</div><div class="line">        options: &#123;</div><div class="line">          // keepalive: true,</div><div class="line">          base: cfg.src,</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    //打开浏览器</div><div class="line">    open: &#123;</div><div class="line">      server: &#123;</div><div class="line">        url: &apos;http://localhost:&apos; + cfg.serverPort</div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    //监控文件变化</div><div class="line">    watch: &#123;</div><div class="line">      options: &#123;</div><div class="line">        livereload: cfg.livereload,</div><div class="line">      &#125;,</div><div class="line">      server: &#123;</div><div class="line">        files: [</div><div class="line">        &apos;&lt;%= cfg.src %&gt;/&#123;,*/&#125;*.html&apos;,</div><div class="line">        &quot;&lt;%= cfg.src %&gt;/css/*.css&quot;,</div><div class="line">        &quot;&lt;%= cfg.src %&gt;/js/*.js&quot;,</div><div class="line">        &quot;&lt;%= cfg.src %&gt;/img/*&quot;</div><div class="line">        ],</div><div class="line">        // tasks: [&apos;&apos;],       </div><div class="line">      &#125;,</div><div class="line">    &#125;</div><div class="line">  &#125;);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>然后执行 <code>grunt server</code>，就会在你的浏览器打开这个地址 <code>http://localhost:9000</code>。</p>
<p><del>的撒大声地</del></p>
</div></article></div></section><footer><div class="paginator"><a href="/2014/06/27/0627-前端规范--思维导图/" class="prev">上一篇</a><a href="/2014/06/24/0624-grunt common plugin/" class="next">下一篇</a></div><div class="copyright"><p>© 2016 - 2017 <a href="http://iamtutu.com">ASJMTZ</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>