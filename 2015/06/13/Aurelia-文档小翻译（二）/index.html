
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>Aurelia-文档小翻译（二） | Asjmtz&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="Asjmtz">
    
    <meta name="description" itemprop="description" content="Aurelia 文档翻译下部分，from Routing part">
    
    
    
    
    
    <link rel="icon" href="/img/me.ico">
    
    
    <link rel="apple-touch-icon" href="/img/author-me.png">
    <link rel="apple-touch-icon-precomposed" href="/img/author-me.png">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
    <link rel="stylesheet" type="text/css" href="/pace/templates/pace-theme.css">
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/author-me.png" alt="Asjmtz&#39;s Blog" title="Asjmtz&#39;s Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Asjmtz&#39;s Blog">Asjmtz&#39;s Blog</a></h1>
				<h2 class="blog-motto">不想做画家的黑客不是好前端o(∩_∩)o</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜單">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/lab">Lab</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:iamtutu.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/06/13/Aurelia-文档小翻译（二）/" title="Aurelia-文档小翻译（二）" itemprop="url">Aurelia-文档小翻译（二）</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://iamtutu.com" title="Asjmtz">Asjmtz</a>
    </p>
  <p class="article-time">
    <time datetime="2015-06-13T06:07:27.000Z" itemprop="datePublished">Jun 13 2015</time>
    更新日期:<time datetime="2015-06-18T08:12:05.000Z" itemprop="dateModified">Jun 18 2015</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目錄</strong>
		<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Routing"><span class="toc-number">1.</span> <span class="toc-text">Routing</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#The_Screen_Activation_Lifecycle"><span class="toc-number">1.1.</span> <span class="toc-text">The Screen Activation Lifecycle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Child_Routers"><span class="toc-number">1.2.</span> <span class="toc-text">Child Routers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Conventional_Routing"><span class="toc-number">1.3.</span> <span class="toc-text">Conventional Routing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Customizing_the_Navigation_Pipeline"><span class="toc-number">1.4.</span> <span class="toc-text">Customizing the Navigation Pipeline</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Configuring_PushState"><span class="toc-number">1.5.</span> <span class="toc-text">Configuring PushState</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reusing_an_existing_VM"><span class="toc-number">1.6.</span> <span class="toc-text">Reusing an existing VM</span></a></li></ol></li></ol>
		</div>
		
		<h2 id="Routing">Routing</h2><p>你可能会需要创建许多不同的应用类型。从 navigation apps、dashboards，到 MDI interfaces，Aurelia 都能完全掌控。这些架构中大多数的关键组件都是一个客户端路由，用来将 url 解析到应用状态中。</p>
<p>如果你读过了开始向导，你会知道完成路由需要两步。首先，在你的 view-model 中有一个 <code>Router</code>，我们通过添加一些路由信息和控制向导来配置他。之后，view 中 的一个 <code>router-view</code> 负责展示路由中定义的当前状态指向的模块。</p>
<p>例子：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">export <span class="class"><span class="keyword">class</span> <span class="title">App</span> &#123;</span></span><br><span class="line">  configureRouter(config, router)&#123;</span><br><span class="line">    <span class="keyword">this</span>.router = router;</span><br><span class="line"></span><br><span class="line">    config.title = <span class="string">'Aurelia'</span>;</span><br><span class="line">    config.map([</span><br><span class="line">      &#123; <span class="string">route:</span> [<span class="string">''</span>, <span class="string">'home'</span>],       <span class="string">name:</span> <span class="string">'home'</span>,       <span class="string">moduleId:</span> <span class="string">'./home/index'</span> &#125;,</span><br><span class="line">      &#123; <span class="string">route:</span> <span class="string">'users'</span>,            <span class="string">name:</span> <span class="string">'users'</span>,      <span class="string">moduleId:</span> <span class="string">'./users/index'</span>,                      <span class="string">nav:</span> <span class="literal">true</span> &#125;,</span><br><span class="line">      &#123; <span class="string">route:</span> <span class="string">'users/:id/detail'</span>, <span class="string">name:</span> <span class="string">'userDetail'</span>, <span class="string">moduleId:</span> <span class="string">'./users/detail'</span> &#125;,</span><br><span class="line">      &#123; <span class="string">route:</span> <span class="string">'files*path'</span>,       <span class="string">name:</span> <span class="string">'files'</span>,      <span class="string">moduleId:</span> <span class="string">'./files/index'</span>,     <span class="string">href:</span><span class="string">'#files'</span>,   <span class="string">nav:</span> <span class="literal">true</span> &#125;</span><br><span class="line">    ]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们开始先实现 <code>configureRouter</code> 方法。我们可以有选择的设置下 <code>title</code>，这个属性用来构建文档的标题，但是更重要的部分是设置路由。路由的 <code>map</code> 方法用一个简单的 JSON 数据来展示路由表。</p>
<p>两个最重要的属性是 <code>route</code> （一个数组或字符串），定义 route pattern；<code>moduleId</code>，指向你的 view-model 的相对 module id 路径。你也可以设置 <code>name</code>属性，用来生成一个路由的链接，<code>title</code>属性用来生成文档的 title，<code>nav</code>属性表明了向导模型（navigation model）是否包含该路由，在向导模型中 <code>href</code>用来绑定。</p>
<blockquote>
<p>Note: Any properties that you leave off will be conventionally determined by the framework based on what you have provided.</p>
</blockquote>
<p>So，对于 route pattern 你有那些选择哪：</p>
<ul>
<li>静态路由<ul>
<li>例如：’home’ - 直接匹配字符串</li>
</ul>
</li>
<li>有参数的路由<ul>
<li>例如：’users/:id/detail’ - 匹配字符串并且解析一个 <code>id</code> 参数。你的 view-model 的 <code>activate</code> 回调会被调用，并将会传入一个带着 <code>id</code> 的对象，<code>id</code> 的值是从 url 中提取的</li>
</ul>
</li>
<li>通配符路由（wildcard routes）<ul>
<li>例如：’files*path’ - 匹配字符串和其他符合他的。你的 view-model 的 <code>activate</code> 回调会被调用，且传入一个带着 <code>path</code> 属性的对象，<code>path</code> 的值是给通配符的值。</li>
</ul>
</li>
</ul>
<p>所有的路由实际都有一个 <code>nav</code> 属性被组合进 <code>navigation</code> 数组。这使得用数据绑定来生成菜单结构变得很简单。另一个对绑定很重要的属性是 <code>isNavigating</code>。下面是一个简单的例子，向你展示如何使用上面的路由构建一个 view：</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">template</span>&gt;</span><br><span class="line">  &lt;ul&gt;</span><br><span class="line">    &lt;li class=<span class="string">"loader"</span> <span class="keyword">if</span>.<span class="keyword">bind</span>=<span class="string">"router.isNavigating"</span>&gt;</span><br><span class="line">      &lt;i class=<span class="string">"fa fa-spinner fa-spin fa-2x"</span>&gt;&lt;/i&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;li repeat.<span class="keyword">for</span>=<span class="string">"item of router.navigation"</span>&gt;</span><br><span class="line">      &lt;a href.<span class="keyword">bind</span>=<span class="string">"item.href"</span>&gt;$&#123;item.title&#125;&lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">  &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">&lt;/<span class="keyword">template</span>&gt;</span><br></pre></td></tr></table></figure>
<h3 id="The_Screen_Activation_Lifecycle">The Screen Activation Lifecycle</h3><p>无论路由何时处理一个向导，在路由来往的这两个 view-model，都会创建一个准确的生命周期（Whenever the router processes a navigation, it enforces a strict lifecycle on the view-models that it is navigating to and from）。这个生命周期有四个阶段。通过的在 view-model 的类中实现对应的方法，你可以有选择使用这些阶段， Here’s a list of the lifecycle callbacks:</p>
<ul>
<li><code>canActivate(params, routeConfig, navigationInstruction)</code> - 控制是否能路由进入（ navigate to）到你的 view-model。返回一个 boolean 值、一个返回boolean 值的 promise，或者一个向导命令（navigation command）。</li>
<li><code>activate(params, routeConfig, navigationInstruction)</code> - 在 view-model 展示之前执行你的自定义逻辑。可以有选择的返回一个 promise 来告诉路由等待直到你完成你的逻辑，才进行数据和视图的绑定。</li>
<li><code>canDeactivate()</code> -  控制是否能路由离开（ navigate away）你的 view-model。返回一个 boolean 值、一个返回boolean 值的 promise，或者一个向导命令（navigation command）。</li>
<li><code>deactivate()</code> - 在离开 view-model 之后执行你的自定义逻辑。可以有选择的返回一个 promise 来告诉路由等待直到你完成你的逻辑。</li>
</ul>
<p><code>param</code> 是由路由解析的每个参数组成的对象。<code>routeConfig</code> 是你设置的路由配置参数。<code>routeConfig</code>  也会有一个新的 <code>navModel</code> 属性，他可以用你的 view-model 中加载的数据来改变 document 标题。例如：</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">activate(params, routeConfig) &#123;</span><br><span class="line">  this.<span class="keyword">user</span>Service.getUser(params.id)</span><br><span class="line">    .then(<span class="keyword">user</span> =&gt; &#123;</span><br><span class="line">      routeConfig.navModel.<span class="built_in">set</span>Title(<span class="keyword">user</span>.name);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note: 一个向导的命令是一个带有 <code>navigate(router)</code> 方法的对象。 When one is encountered, the navigation will be cancelled and control will be passed to the navigation command. One navigation command is provided out of the box: <code>Redirect</code>.</p>
</blockquote>
<h3 id="Child_Routers">Child Routers</h3><p>如果你已经阅读了 “Get Started” 向导，我们建议你现在特别注意这个章节  “Bonus: Leveraging Child Routers”。</p>
<p>即使你已经设置一个路由映射到view-model，这个 view-model 也还可以包含他自己的路由，然后子路由的 view-model 也可以包含自己的子路由，如此循环……路由模式（route patterns）相对于父级路由，而模块和视图 id 是相对于view-model。他让你可以简单的封装特性或者子应用，以及控制复杂的分层状态（hierarchical state）。</p>
<p>子路由与其他路由并无差异。So，我们上面所讨论的路由相关都适用于他。添加子路由只需要再次实现 <code>configureRouter</code> 方法。上面讨论的  screen activation lifecycle 也适用于他。Each phase of the lifecycle is run against the entire router hierarchy before moving on to the next phase. The activate hooks run from top to bottom and the deactivate hooks run from bottom to top.</p>
<h3 id="Conventional_Routing">Conventional Routing</h3><p>As with everything in Aurelia, we have strong support for conventions. 你可以选择配置动态路由而不是一个预先配置的路由。动态路由的栗子：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">export</span> <span class="tag">class</span> <span class="tag">App</span> &#123;</span><br><span class="line">  <span class="tag">configureRouter</span>(config)&#123;</span><br><span class="line">    <span class="tag">config</span><span class="class">.mapUnknownRoutes</span>(instruction =&gt; &#123;</span><br><span class="line">      <span class="comment">//check instruction.fragment</span></span><br><span class="line">      <span class="comment">//set instruction.config.moduleId</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>你只需要设置 <code>config.moduleId</code> 属性，也可以从 <code>mapUnknownRoutes</code> 返回一个 promise 来异步设置路由目标。</p>
<blockquote>
<p>Note: Though not necessarily related to conventional routing, you may sometimes have a need to asynchronously configure your router. For example, you may need to call a web service to get user permissions before setting up routes. To do this, return a promise from <code>configureRouter</code>.</p>
</blockquote>
<h3 id="Customizing_the_Navigation_Pipeline">Customizing the Navigation Pipeline</h3><p>The router pipeline is composed out of separate steps that run in succession. Each of these steps has the ability to modify what happens during routing, or stop the routing altogether. The pipeline also contains a few extensibility points where you can add your own steps. These are authorize and modelbind. authorize happens before modelbind. These extensions are called route filters.</p>
<p>下面是一个添加授权（authorization）到应用中的例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Redirect&#125; <span class="keyword">from</span> <span class="string">'aurelia-router'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">	configureRouter(config)&#123;</span><br><span class="line">		config.title = <span class="string">'Aurelia'</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//Add a route filter to the authorize extensibility point</span></span><br><span class="line">		config.addPipelineStep(<span class="string">'authorize'</span>, AuthorizeStep); </span><br><span class="line"></span><br><span class="line">		config.map([</span><br><span class="line">			&#123; </span><br><span class="line">				route: [<span class="string">'welcome'</span>],</span><br><span class="line">				name: <span class="string">'welcome'</span>,</span><br><span class="line">				moduleId: <span class="string">'welcome'</span>,</span><br><span class="line">				nav: <span class="literal">true</span>,</span><br><span class="line">				title: <span class="string">'Welcome'</span></span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				route: <span class="string">'flickr'</span>,</span><br><span class="line">				name: <span class="string">'flickr'</span>,</span><br><span class="line">				<span class="built_in">module</span>: <span class="string">'flickr'</span>,</span><br><span class="line">				nav: <span class="literal">true</span>,</span><br><span class="line">				auth: <span class="literal">true</span></span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				route: <span class="string">''</span>,</span><br><span class="line">				redirect: <span class="string">'welcome'</span></span><br><span class="line">			&#125;</span><br><span class="line">		]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AuthorizeStep</span></span>&#123;</span><br><span class="line">	run(routingContext, next)&#123;</span><br><span class="line">		<span class="comment">// Check if the route has an 'auth' key</span></span><br><span class="line">		<span class="comment">// The reason for using 'nextInstructions' is because</span></span><br><span class="line">		<span class="comment">// this includes child routes</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>( routingContext.nextInstructions.some(i =&gt; i.config.auth) ) &#123;</span><br><span class="line">			<span class="keyword">var</span> isLoggedIn = <span class="comment">/* insert magic here */</span><span class="literal">false</span>;</span><br><span class="line">			<span class="keyword">if</span> ( !isLoggedIn ) &#123;</span><br><span class="line">				<span class="keyword">return</span> next.cancel(<span class="keyword">new</span> Redirect(<span class="string">'login'</span>));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> next();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这些扩展点也有自己的小管道线，每个小管道都能添加多步骤。例如，上面栗子中的 <code>AuthorizeStep</code> 会检查用户是否登录，你可以在 <code>authorize</code> 的扩展点加入 <code>IsAdminStep</code> ——是否 Admin 的步骤，他们将会按顺序进行。</p>
<p>你也可以创建自己的 filters，只要在 <code>addPipelineStep</code> 中传入一个不同的名字，具体是这样的：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">config.addPipelineStep(<span class="string">'myname'</span>, MyFirstStep); <span class="comment">// Transparently creates the pipeline "myname" if it doesn't already exist.</span></span><br><span class="line">config.addPipelineStep(<span class="string">'myname'</span>, MySecondStep); <span class="comment">// Adds another step to it.</span></span><br><span class="line">config.addPipelineStep(<span class="string">'modelbind'</span>, <span class="string">'myname'</span>); <span class="comment">// Makes the entire `myname` pipeline run as part of the `modelbind` pipeline.</span></span><br></pre></td></tr></table></figure>
<h3 id="Configuring_PushState">Configuring PushState</h3><p>如果你不喜欢 <code>#</code> 的哈希标识出现在你的 URLs，你就需要在你的应用中使用 <code>pushState</code>。为了让他正常跑起来，你还需要在 server 端做点工作。让我们先从 Aurelia 这边开始码。</p>
<p>首先你需要在 <code>router</code> 的 <code>config</code> 中告诉 Aurelia ，你想使用 <code>pushState</code> ：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">export <span class="class"><span class="keyword">class</span> <span class="title">App</span> &#123;</span></span><br><span class="line">	configureRouter(config)&#123;</span><br><span class="line">		config.title = <span class="string">'Aurelia'</span>;</span><br><span class="line">		config.options.pushState = <span class="literal">true</span>; <span class="comment">// &lt;-- this is all you need here</span></span><br><span class="line">		config.map([</span><br><span class="line">	      &#123; <span class="string">route:</span> [<span class="string">'welcome'</span>],    <span class="string">name:</span> <span class="string">'welcome'</span>,     <span class="string">moduleId:</span> <span class="string">'welcome'</span>,      <span class="string">nav:</span> <span class="literal">true</span>, <span class="string">title:</span><span class="string">'Welcome'</span> &#125;,</span><br><span class="line">	      &#123; <span class="string">route:</span> <span class="string">'flickr'</span>,       <span class="string">name:</span> <span class="string">'flickr'</span>,      <span class="string">moduleId:</span> <span class="string">'flickr'</span>,       <span class="string">nav:</span> <span class="literal">true</span>, <span class="string">auth:</span> <span class="literal">true</span> &#125;,</span><br><span class="line">	      &#123; <span class="string">route:</span> <span class="string">'child-router'</span>, <span class="string">name:</span> <span class="string">'childRouter'</span>, <span class="string">moduleId:</span> <span class="string">'child-router'</span>, <span class="string">nav:</span> <span class="literal">true</span>, <span class="string">title:</span><span class="string">'Child Router'</span> &#125;,</span><br><span class="line">	      &#123; <span class="string">route:</span> <span class="string">''</span>,             <span class="string">redirect:</span> <span class="string">'welcome'</span> &#125;</span><br><span class="line">	    ]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>你还需要添加一个 <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base" target="_blank" rel="external">base 标签</a> 在html 文档的 head。这个很重要，请别忘记他。</p>
<p>接下来， server 端需要配置：不管发送什么请求都需要返回同个 <code>index.html</code>，因为所有的路由操作都在客户端。所以，如果你在依照栗子用 <code>gulp watch</code> 和 <code>browsersync</code>，你可以将设置改为：</p>
<p>npm 安装 依赖包：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="operator"><span class="keyword">install</span> <span class="comment">--save connect-history-api-fallback</span></span></span><br></pre></td></tr></table></figure>
<p>这是在下载安装你需要的中间件。之后打开 <em>build/tasks</em> 文件夹的 <em>Server</em> 任务，将下面这句放在顶部与其他引用的语句一起：</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="reserved">var</span> historyApiFallback = <span class="built_in">require</span>(<span class="string">'connect-history-api-fallback'</span>);</span><br></pre></td></tr></table></figure>
<p>下面就可以用新的 <code>middleware</code> 修改 <code>serve</code> task“</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">gulp.task(<span class="string">'serve'</span>, [<span class="string">'build'</span>], <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">	browserSync(&#123;</span><br><span class="line">		open: <span class="keyword">false</span>,</span><br><span class="line">		port: <span class="number">9000</span>,</span><br><span class="line">		serve: &#123;</span><br><span class="line">			baseDir: [<span class="string">'.'</span>],</span><br><span class="line">			middleware: [historyApiFallback, <span class="function"><span class="keyword">function</span><span class="params">(req, res, next)</span></span>&#123;</span><br><span class="line">				res.setHeader(<span class="string">'Access-Control-Allow-Origin'</span>,<span class="string">'*'</span>);</span><br><span class="line">				<span class="built_in">next</span>();</span><br><span class="line">			&#125;]</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;, done);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>现在，你的 node 服务器就会将路由控制权交给 Aurelia 了。</p>
<p>如果你在使用 ASP.NET 或 MVC 等 .NET 服务端框架，可以像这样配置：</p>
<ul>
<li>创建一个控制器叫他 <code>ApplicationController</code> 或者其他你想叫的:</li>
</ul>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">	</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ApplicationController</span> : <span class="title">Controller</span> &#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> ActionResult <span class="title">Index</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> View();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>创建一个 “index.cshtml” 视图在视图文件夹</li>
<li>设置路由配置为：</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">context</span><span class="class">.MapRoute</span>(</span><br><span class="line">  <span class="rule"><span class="attribute">name</span>:<span class="value"> <span class="string">"AureliaRouting"</span>,</span><br><span class="line">  url: <span class="string">"&#123;*.&#125;"</span>,</span><br><span class="line">  defaults: new &#123; controller = <span class="string">"Application"</span>, action = <span class="string">"Index"</span> &#125;</span><br><span class="line">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>注意上面的配置将强制使用一个 Razor 视图文件。如果你想使用一个普通 HTML 文件，将使用不同的方法：<a href="http://stackoverflow.com/questions/20871938/render-html-file-in-asp-net-mvc-view" target="_blank" rel="external"> This SO article might help you.</a></p>
<p>If you are using <a href="http://nancyfx.org/" target="_blank" rel="external">Nancy FX</a>, then the config is just as simple. Locate your <code>IndexModule.cs</code> or whatever you called it and make sure it looks something like this and all will be well:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">IndexModule</span> : <span class="title">NancyModule</span> </span>&#123;</span><br><span class="line">  public IndexModule()     &#123;</span><br><span class="line">    <span class="keyword">this</span>.Get[<span class="string">"/robots.txt"</span>] = p =&gt; <span class="keyword">this</span>.Response.AsFile(<span class="string">"robots.txt"</span>);</span><br><span class="line">    <span class="keyword">this</span>.Get[<span class="string">"/sitemap.xml"</span>] = p =&gt; <span class="keyword">this</span>.Response.AsFile(<span class="string">"sitemap.xml"</span>);</span><br><span class="line">    <span class="keyword">this</span>.Get[<span class="string">"/"</span>] = x =&gt; <span class="keyword">this</span>.View[<span class="string">"index"</span>];</span><br><span class="line">    <span class="keyword">this</span>.Get[<span class="string">"/&#123;path*&#125;"</span>] = x =&gt; <span class="keyword">this</span>.View[<span class="string">"index"</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Similar techniques can be used in other server environments - you just need to make sure that whatever server you’re using, it needs to send back the same <code>index.html</code> regardless of the request being made. All server side frameworks should be able to achieve this. Aurelia will figure out which page to load based on its own route data.</p>
<h3 id="Reusing_an_existing_VM">Reusing an existing VM</h3><p>有时你会想要在不同的路由中重用已存在的 View-Model。Aurelia 默认会将那 些路由作为同个 View-Model 的别名，然后只会 build 生命周期、绑定一次。可能这并不是你想要的。看下面的栗子：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">export <span class="class"><span class="keyword">class</span> <span class="title">App</span> &#123;</span></span><br><span class="line">  configureRouter(config) &#123;</span><br><span class="line">    config.title = <span class="string">'Aurelia'</span>;</span><br><span class="line">    config.map([</span><br><span class="line">      &#123; <span class="string">route:</span> <span class="string">'product/a'</span>,    <span class="string">moduleId:</span> <span class="string">'./product'</span>,     <span class="string">nav:</span> <span class="literal">true</span> &#125;,</span><br><span class="line">      &#123; <span class="string">route:</span> <span class="string">'product/b'</span>,    <span class="string">moduleId:</span> <span class="string">'./product'</span>,     <span class="string">nav:</span> <span class="literal">true</span> &#125;,</span><br><span class="line">    ]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
  
	</div>
		<footer class="article-footer clearfix">


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Aurelia/">Aurelia</a>
</div>



<div class="article-share" id="share">

  <div data-url="http://iamtutu.com/2015/06/13/Aurelia-文档小翻译（二）/" data-title="Aurelia-文档小翻译（二） | Asjmtz&#39;s Blog" data-tsina="asjmtz" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/2015/06/09/Aurelia-文档小翻译/"  title="Aurelia 文档小翻译">
 <strong>NEXT:</strong><br/> 
 <span>Aurelia 文档小翻译
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="顯示側邊欄"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目錄</strong>
  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Routing"><span class="toc-number">1.</span> <span class="toc-text">Routing</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#The_Screen_Activation_Lifecycle"><span class="toc-number">1.1.</span> <span class="toc-text">The Screen Activation Lifecycle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Child_Routers"><span class="toc-number">1.2.</span> <span class="toc-text">Child Routers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Conventional_Routing"><span class="toc-number">1.3.</span> <span class="toc-text">Conventional Routing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Customizing_the_Navigation_Pipeline"><span class="toc-number">1.4.</span> <span class="toc-text">Customizing the Navigation Pipeline</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Configuring_PushState"><span class="toc-number">1.5.</span> <span class="toc-text">Configuring PushState</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reusing_an_existing_VM"><span class="toc-number">1.6.</span> <span class="toc-text">Reusing an existing VM</span></a></li></ol></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隱藏側邊欄"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分類</p>
		<ul>
		
			<li><a href="/categories/Angular/" title="Angular">Angular<sup>5</sup></a></li>
		
			<li><a href="/categories/Aurelia/" title="Aurelia">Aurelia<sup>2</sup></a></li>
		
			<li><a href="/categories/Grunt/" title="Grunt">Grunt<sup>4</sup></a></li>
		
			<li><a href="/categories/Yeoman/" title="Yeoman">Yeoman<sup>1</sup></a></li>
		
			<li><a href="/categories/git/" title="git">git<sup>4</sup></a></li>
		
			<li><a href="/categories/html/" title="html">html<sup>1</sup></a></li>
		
			<li><a href="/categories/js/" title="js">js<sup>6</sup></a></li>
		
			<li><a href="/categories/phonegap/" title="phonegap">phonegap<sup>1</sup></a></li>
		
			<li><a href="/categories/svg/" title="svg">svg<sup>2</sup></a></li>
		
			<li><a href="/categories/test/" title="test">test<sup>2</sup></a></li>
		
			<li><a href="/categories/to-do/" title="to-do">to-do<sup>2</sup></a></li>
		
			<li><a href="/categories/手绘/" title="手绘">手绘<sup>1</sup></a></li>
		
			<li><a href="/categories/规范/" title="规范">规范<sup>2</sup></a></li>
		
			<li><a href="/categories/音乐/" title="音乐">音乐<sup>1</sup></a></li>
		
		</ul>
</div>


  

  
  <div class="archiveslist">
    <p class="asidetitle"><a href="/archives">歸檔</a></p>
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a><span class="archive-list-count">10</span></li></ul>
  </div>


  <div class="rsspart">
	<a href="null" target="_blank" title="rss">RSS 訂閱</a>
</div>

  <div class="linkslist">
  <p class="asidetitle">友情鏈接</p>
    <ul>
      <li><a href="http://yangjian.me" target="_blank" title="YangJian">Alimon's Blog</a></li>
      <li><a href="http://hexo.io" target="_blank" title="Hexo">Hexo</a></li>
    </ul>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> 爱斯基摩兔子是也 <br/>
			最近追什么番比较好哪？</p>
	</section>
	 
	<div class="social-font clearfix">
		
		<a href="http://weibo.com/asjmtz" target="_blank" title="weibo"></a>
		
		
		
		<a href="https://github.com/asjmtz" target="_blank" title="github"></a>
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2015 
		
		<a href="http://iamtutu.com" target="_blank" title="Asjmtz">Asjmtz</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript" src="/pace/pace.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"asjmtz"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?3014521f2cf9b3f5b28fcaf8a31d2524";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


  </body>
</html>
